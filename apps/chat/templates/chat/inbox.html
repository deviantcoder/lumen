{% extends '_base.html' %}

{% block head_title %}
    Messages
{% endblock head_title %}

{% block content %}
<div class="container mt-76 pb-76">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="d-flex align-items-center gap-2 mb-3">
                <i class="bi bi-chat-heart fs-4"></i>
                <span class="fw-bold fs-4">Messages</span>
            </div>
            <div class="list-group">
                {% for item in chats %}
                    <a href="{% url 'chat:chat' item.chat.id %}" class="list-group-item border-0 rounded-5 mb-2 list-group-item-action d-flex align-items-center p-3">
                        <img src="{{ item.other_user.profile.image_or_default }}" class="profile-img-md me-2" alt="User avatar">
                        <div class="flex-grow-1">
                            <div class="fw-semibold text-white">{{ item.other_user.username }}</div>
                            <small class="text-muted">
                                {% if item.last_message %}
                                    {% with message=item.last_message %}
                                        {% if message.sender == request.user %}
                                            You:
                                        {% else %}
                                            @{{ message.sender.username }}:
                                        {% endif %}
                                        {% if message.message_type == 'text' %}
                                            {{ message.content|slice:80 }}...
                                        {% else %}
                                            Post
                                        {% endif %}
                                    {% endwith %}
                                {% endif %}
                            </small>
                        </div>
                        <small class="text-muted">{{ item.last_message.time_sent }}</small>
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% include 'feed/includes/mobile_nav.html' %}
{% endblock content %}